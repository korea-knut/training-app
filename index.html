<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì „ë¬¸ íŠ¸ë ˆì´ë„ˆ ì•±</title>
  <style>
    :root {
      --primary: #2e7dff;
      --accent: #00bcd4;
      --background: #f4f6f8;
      --card-bg: #ffffff;
      --text-main: #222;
      --text-sub: #666;
      --border: #ddd;
    }

    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background-color: var(--background);
      color: var(--text-main);
      padding: 20px;
      margin: 0;
    }

    h1, h2 {
      color: var(--primary);
      font-weight: 600;
    }

    button {
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      margin: 6px 4px;
      font-size: 15px;
      cursor: pointer;
    }
    button:hover {
      background: #155bd4;
    }

    select, textarea {
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 6px;
      margin-top: 8px;
      width: 100%;
      box-sizing: border-box;
    }

    #main, #log, #stats {
      background: var(--card-bg);
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      margin-top: 16px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 16px;
    }
    th, td {
      border: 1px solid var(--border);
      padding: 10px;
      text-align: center;
    }

    #response {
      margin-top: 16px;
      background: #e3f2fd;
      padding: 10px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <button onclick="showSection('main')">ğŸ  í™ˆ</button>
  <button onclick="showSection('log')">ğŸ““ ìš´ë™ ì¼ì§€</button>
  <button onclick="showSection('stats')">ğŸ“Š ìš´ë™ í†µê³„</button>

  <div id="main">
    <h2>ìš”ì¼ë³„ ë£¨í‹´ ê³„íší‘œ</h2>
    <table>
      <tr><th>ìš”ì¼</th><th>ë£¨í‹´</th></tr>
      <tr><td>ì›”ìš”ì¼</td><td>ë£¨í‹´ 1 - ìƒì²´</td></tr>
      <tr><td>í™”ìš”ì¼</td><td>ë£¨í‹´ 2 - í•˜ì²´</td></tr>
      <tr><td>ìˆ˜ìš”ì¼</td><td>ë£¨í‹´ 1 - ìƒì²´</td></tr>
      <tr><td>ëª©ìš”ì¼</td><td>ë£¨í‹´ 2 - í•˜ì²´</td></tr>
      <tr><td>ê¸ˆìš”ì¼</td><td>ë£¨í‹´ 3 - ë“±/ì½”ì–´</td></tr>
      <tr><td>í† ìš”ì¼</td><td>ììœ  ì„ íƒ or íœ´ì‹</td></tr>
      <tr><td>ì¼ìš”ì¼</td><td>íœ´ì‹</td></tr>
    </table>

    <h1>ì˜¤ëŠ˜ì˜ ë£¨í‹´</h1>
    <label>ì§ì ‘ ë£¨í‹´ ì„ íƒ:
      <select id="routineSelector" onchange="setRoutine()">
        <option value="rest">íœ´ì‹</option>
        <option value="routine1">ë£¨í‹´ 1 - ìƒì²´</option>
        <option value="routine2">ë£¨í‹´ 2 - í•˜ì²´</option>
        <option value="routine3">ë£¨í‹´ 3 - ë“±/ì½”ì–´</option>
      </select>
    </label>
    <ul id="routine"></ul>

    <label><input type="checkbox" id="skipCheckbox"> ì˜¤ëŠ˜ì€ í•´ì•¼ í–ˆì§€ë§Œ ëª»í–ˆìŒ (ê¸°ë¡ìš©)</label>

    <h2>ì‹ë‹¨ ì…ë ¥</h2>
    <textarea id="mealInput" rows="4" placeholder="ì˜¤ëŠ˜ ë¨¹ì€ ì‹ë‹¨ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea><br>
    <button onclick="getGPT()">GPT í”¼ë“œë°± ë°›ê¸°</button>

    <div id="response"></div>

    <h2>íƒ€ì´ë¨¸</h2>
    <p>í˜„ì¬ ì„¸íŠ¸: <span id="current-set">1</span>/3</p>
    <p>ì„¸íŠ¸ íƒ€ì´ë¨¸: <span id="set-timer">00:45</span></p>
    <p>íœ´ì‹ íƒ€ì´ë¨¸: <span id="rest-timer">01:00</span></p>
    <button onclick="startWorkoutRoutine()">ì „ì²´ ë£¨í‹´ ì‹œì‘</button>
    <button onclick="stopTimers()">ì¤‘ì§€</button>
    <button onclick="downloadPDF()">PDFë¡œ ì €ì¥í•˜ê¸°</button>
  </div>

  <div id="log">
    <h2>ìš´ë™ ì¼ì§€ (ì´ë²ˆ ë‹¬)</h2>
    <div id="logList"></div>
  </div>

  <div id="stats">
    <h2>ìš´ë™ í†µê³„ (ì´ë²ˆ ë‹¬)</h2>
    <div id="statsList"></div>
    <h3>ğŸ“Š ì˜¬í•´ ì›”ë³„ ìš´ë™ ì„±ê³µë¥ </h3>
    <div id="yearlyStats"></div>
  </div>

  <audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const { jsPDF } = window.jspdf;

    function showSection(section) {
      document.getElementById('main').style.display = 'none';
      document.getElementById('log').style.display = 'none';
      document.getElementById('stats').style.display = 'none';
      document.getElementById(section).style.display = 'block';
      if (section === 'stats') {
        renderStats();
        renderYearlyStats();
      }
      if (section === 'log') renderLog();
    }

    function renderStats() {
      const logs = JSON.parse(localStorage.getItem('workoutLog') || '[]');
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();
      const stats = [];
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      for (let i = 1; i <= daysInMonth; i++) {
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
        const log = logs.find(l => l.date === dateStr);
        stats.push({ date: dateStr, status: log ? (log.message.includes('ê²°ì„') ? 'âŒ' : 'âœ…') : 'â¬œ' });
      }
      const html = stats.map(s => `<p><strong>${s.date}</strong>: ${s.status}</p>`).join('');
      document.getElementById('statsList').innerHTML = html;
    }

    function renderYearlyStats() {
      const logs = JSON.parse(localStorage.getItem('workoutLog') || '[]');
      const now = new Date();
      const year = now.getFullYear();
      const monthlyStats = Array.from({ length: 12 }, (_, i) => {
        const month = String(i + 1).padStart(2, '0');
        const matches = logs.filter(l => l.date.startsWith(`${year}-${month}`));
        const total = matches.length;
        const success = matches.filter(m => !m.message.includes('ê²°ì„')).length;
        const rate = total > 0 ? Math.round((success / total) * 100) : 0;
        return `<p><strong>${year}-${month}</strong>: ${rate}% (${success}/${total})</p>`;
      });
      document.getElementById('yearlyStats').innerHTML = monthlyStats.join('');
    }

    function renderLog() {
      const logs = JSON.parse(localStorage.getItem('workoutLog') || '[]');
      const now = new Date();
      const yearMonth = now.toISOString().slice(0, 7);
      const filtered = logs.filter(l => l.date.startsWith(yearMonth));
      const html = filtered.map(log => `<p><strong>${log.date}</strong>: ${log.message}</p>`).join('');
      document.getElementById('logList').innerHTML = html;
    }

    function downloadPDF() {
      const doc = new jsPDF();
      doc.text('ìš´ë™ ì¼ì§€ (ì´ë²ˆ ë‹¬)', 10, 10);

      const logs = JSON.parse(localStorage.getItem('workoutLog') || '[]');
      const now = new Date();
      const thisMonth = now.toISOString().slice(0, 7);
      const logList = logs.filter(l => l.date.startsWith(thisMonth));

      logList.forEach((log, index) => {
        doc.text(`${log.date}: ${log.message}`, 10, 20 + (index * 10));
      });

      doc.save('ìš´ë™ì¼ì§€.pdf');
    }
  </script>

 <!-- Service Worker -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/service-worker.js') // service worker ë“±ë¡
        .then(registration => {
          console.log('Service Worker ë“±ë¡ ì„±ê³µ:', registration);
        })
        .catch(error => {
          console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
        });
    });
  }
</script>

<!-- Manifest ì—°ê²° -->
<link rel="manifest" href="manifest.json">

<!-- PWA ì„¤ì¹˜ ë²„íŠ¼ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€) -->
<button id="installBtn" style="display:none;">í™ˆ í™”ë©´ì— ì¶”ê°€</button>

<script>
  let deferredPrompt;

  // 'beforeinstallprompt' ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´, ì„¤ì¹˜ ë²„íŠ¼ì„ ë³´ì´ê²Œ í•¨
  window.addEventListener('beforeinstallprompt', (event) => {
    // 'beforeinstallprompt' ì´ë²¤íŠ¸ë¥¼ ë§‰ì§€ ì•Šê³  ì €ì¥
    deferredPrompt = event;

    // ì„¤ì¹˜ ë²„íŠ¼ì„ í‘œì‹œ
    document.getElementById('installBtn').style.display = 'inline-block';

    // ì„¤ì¹˜ ë²„íŠ¼ í´ë¦­ ì‹œ, ì„¤ì¹˜ ìš”ì²­
    document.getElementById('installBtn').addEventListener('click', () => {
      // ì‚¬ìš©ìê°€ ì•±ì„ ì„¤ì¹˜í•  ìˆ˜ ìˆë„ë¡ í”„ë¡¬í”„íŠ¸ í‘œì‹œ
      deferredPrompt.prompt();
      
      // ì‚¬ìš©ìê°€ ì„ íƒí•œ ê²°ê³¼ì— ë”°ë¼ ì²˜ë¦¬
      deferredPrompt.userChoice.then((choiceResult) => {
        if (choiceResult.outcome === 'accepted') {
          console.log('ì‚¬ìš©ìê°€ ì•±ì„ ì„¤ì¹˜í•¨');
        } else {
          console.log('ì‚¬ìš©ìê°€ ì•± ì„¤ì¹˜ë¥¼ ê±°ë¶€í•¨');
        }
        // ì´ë²¤íŠ¸ ê°ì²´ ì´ˆê¸°í™”
        deferredPrompt = null;
      });
    });
  });
</script>

  <button id="installBtn" style="display:none;">í™ˆ í™”ë©´ì— ì¶”ê°€</button>

</body>
</html>
